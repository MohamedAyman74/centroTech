<% layout("layouts/boilerplate") %>
    <link rel="stylesheet" href="/stylesheets/accmngment.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
        integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- <div class="navbar">
        <a href="home.html" target="_blank">
            <img class="logo" src="logo.svg" alt="">
        </a>
        <ul class="nav-links">
            <li><a href="login.html">Login</a></li>
            <li><a href="register.html">Register</a></li>
        </ul>
    </div> -->
    <section>
        <div class="first-item">
            <h2>Accounts</h2>
            <i class="fas fa-search"></i>
            <form action="/admins/usersmanagement/" id="search" method="POST">
                <input type="search" name="searched" id="searchInput" placeholder="Search by any field">
            </form>
        </div>
        <div class="accounts-container">
            <table id="usersTable">
                <thead>
                    <tr class="headers">
                        <th>ID</th>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Number</th>
                        <th>Parent Number</th>
                        <th colspan="2">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% users.forEach(user=> { %>
                        <div>
                            <tr class="data">
                                <td id="userId">
                                    <%= user._id %>
                                </td>
                                <td>
                                    <%= user.fullname %>
                                </td>
                                <td>
                                    <%= user.email %>
                                </td>
                                <td>
                                    <%= user.phone %>
                                </td>
                                <td>
                                    <%= user.parentPhone %>
                                </td>
                                <!-- <td id="suspend">Suspend</td> -->
                                <% if(user.isSuspended){ %>
                                    <form action="/admins/usersmanagement/<%= user._id %>?_method=PUT" method="POST">
                                        <td class="unsuspend">
                                            <button>Unsuspend</button>
                                        <td>
                                    </form>
                                    <% }else{ %>
                                        <td>
                                            <button id="suspendbtn">Suspend</button>
                                        </td>
                                        <% } %>
                                            <td id="delete">
                                                <button id="deletebtn" type="submit">Delete</button>
                                            </td>
                                            <td id="pop">
                                                <div class="popup">
                                                    <form action="/admins/usersmanagement/<%= user._id %>?_method=PUT"
                                                        method="POST">
                                                        <label for="suspendReason">Reason of suspension</label>
                                                        <input type="text" value="<%= user._id %>" name="suspendReason">
                                                        <button id="suspend-btn">Suspend</button>
                                                    </form>
                                                </div>
                                            </td>
                            </tr>
                        </div>
                        <% }); %>
                            <% authUsers.forEach(authUser=> { %>
                                <div>
                                    <tr class="data">
                                        <td id="userId">
                                            <%= authUser._id %>
                                        </td>
                                        <td>
                                            <%= authUser.fullname %>
                                        </td>
                                        <td>
                                            <%= authUser.email %>
                                        </td>
                                        <td>
                                            <%= authUser.phone %>
                                        </td>
                                        <td>
                                            <%= authUser.parentPhone %>
                                        </td>
                                        <!-- <td id="suspend">Suspend</td> -->
                                        <% if(authUser.isSuspended){ %>
                                            <form action="/admins/usersmanagement/<%= authUser._id %>?_method=PUT"
                                                method="POST">
                                                <td class="unsuspend">
                                                    <button>Unsuspend</button>
                                                <td>
                                            </form>
                                            <% }else{ %>
                                                <td>
                                                    <button id="suspendbtn">Suspend</button>
                                                </td>
                                                <% } %>
                                                    <td id="delete">
                                                        <button id="deletebtn" type="submit">Delete</button>
                                                    </td>
                                                    <td id="pop">
                                                        <div class="popup">
                                                            <form
                                                                action="/admins/usersmanagement/<%= authUser._id %>?_method=PUT"
                                                                method="POST">
                                                                <label for="suspendReason">Reason of suspension</label>
                                                                <input type="text" value="<%= authUser._id %>"
                                                                    name="suspendReason">
                                                                <button id="suspend-btn">Suspend</button>
                                                            </form>
                                                        </div>
                                                    </td>
                                    </tr>
                                </div>
                                <% }); %>
                </tbody>
            </table>
        </div>
    </section>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"
        integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="/javascripts/accmngment.js"></script>
    <script>
        const tds = $("td.unsuspend").next();
        for (let i = 0; i < tds.length; i++) {
            // console.log(tds);
            tds[i].remove();
        }
    </script>