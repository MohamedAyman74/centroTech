<link rel="stylesheet" href="/stylesheets/overview.css">
<% layout("layouts/boilerplate") %>
    <div class="container">
        <div class="banner">
            <div class="data">
                <h1>
                    <%= course.name %>
                </h1>
                <div class="price">
                    <h3>
                        <%= course.instructor.fullname %>
                    </h3>
                    <p>
                        <%= course.price %> EGP
                    </p>

                </div>
                <p id="details">Lorem ipsum dolor sit, amet consectetur adipisicing elit. Quae, enim esse dicta libero
                    mollitia ratione repellat neque fugit, quibusdam ipsam magni minus voluptatum. Maxime quisquam
                    delectus adipisci ea ipsam esse.
                    Recusandae repellat porro saepe itaque numquam at pariatur labore vitae dolores quia dolorem dolorum
                    libero odio, harum ducimus accusantium unde nemo error adipisci in, consequuntur non! Sit iste
                    voluptatibus eaque?</p>
                <div class="purchase-div">
                    <% if((isAdmin || (isInstructor && user._id.equals(course.instructor._id)))){ %>
                        <a href="/courses/<%= course._id %>"><button id="purchase">Open
                                Lectures</button></a>
                        <% } else if(!isInstructor && user.courses.indexOf(course._id) <=0){ %>
                            <form action="/courses/cart/<%= course._id %>" method="POST">
                                <button type="submit" id="purchase">Purchase</button>
                            </form>
                            <% } else{}%>
                </div>

            </div>
            <div class="course-img">
                <img src="/images/teacherimg.png" alt="">
            </div>
        </div>
        <h1 id="reviews-header">Course Reviews</h1>
        <% reviews.slice().reverse().forEach((review, i)=> { %>
            <div class="topic-container <%= i < 3 ? " active" : "" %>">
                <div class="main-flex">
                    <img src="/images/userimg.png" alt="">
                    <div>
                        <% if(review.reviewedBy){ %>
                            <h4>
                                <%= review.reviewedBy.fullname %>
                                    <% if((review.reviewedBy._id===currentUser) || isAdmin){ %>
                                        <form
                                            action="/courses/show/<%= course._id %>/reviews/<%= review.reviewedBy._id %>/delete/<%= review._id%>?_method=DELETE"
                                            method="POST">
                                            <button>Delete</button>
                                        </form>
                                        <% } %>
                            </h4>
                            <% } else if(review.reviewedByOAuth){ %>
                                <h4>
                                    <%= review.reviewedByOAuth.fullname %>
                                        <% if(review.reviewedByOAuth._id.equals(currentUser) || isAdmin){ %>
                                            <form
                                                action="/courses/show/<%= course._id %>/reviews/<%= review.reviewedByOAuth._id %>/delete/<%= review._id %>?_method=DELETE"
                                                method="POST">
                                                <button>Delete</button>
                                            </form>
                                            <% } %>
                                </h4>
                                <% } %>
                                    <p id="author">
                                        <%= review.review %>
                                    </p>
                    </div>
                    <p id="time">
                        <%= review.date %>
                    </p>
                </div>
            </div>
            <% }); %>

                <% if(reviews.length> 3){ %>
                    <div class="show-more">
                        <button class="show-more">Show more</button>
                    </div>
                    <% } %>
                        <% if((!isAdmin && !isInstructor && user.courses.includes(course._id))){ %>
                            <div class="give-review">
                                <form action="/courses/show/<%= course._id %>" method="POST">
                                    <label for="feedback">Tell Us About Your Experience!</label>
                                    <textarea name="review" id="feedback" rows="10"></textarea>
                                    <button>Submit Review</button>
                                </form>
                            </div>
                            <% } %>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.slim.min.js"
        integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script>
    <script src="/javascripts/courseOverview.js"></script>